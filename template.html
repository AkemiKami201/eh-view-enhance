<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    .fullViewPlane {
        width: 100vw;
        height: 100vh;
        background-color: rgb(0, 0, 0);
        position: fixed;
        top: 0px;
        right: 0px;
        z-index: 1000;
        overflow: hidden scroll;
        transition: height 0.4s ease 0s;
        display: grid;
        align-content: start;
        grid-gap: 10px;
        grid-template-columns: repeat(6, 1fr);
        padding: 30px 0px;
    }

    .fullViewPlane .img-node {
        position: relative;
    }

    .fullViewPlane .img-node img {
        width: 100%;
        border: 2px solid white;
        box-sizing: border-box;
    }

    .retract_full_view {
        height: 0;
        transition: height 0.4s;
    }

    .bigImageFrame {
        position: fixed;
        width: 100%;
        height: 100%;
        right: 0;
        display: flex;
        z-index: 1001;
        background-color: #000000d6;
        justify-content: center;
        transition: width 0.4s;
    }

    .bigImageFrame>img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        position: relative;
    }

    .img_land_left {
        width: 33%;
        height: 100%;
        position: fixed;
        left: 0;
        top: 0;
        z-index: 1002;
        cursor: url("https://tb2.bdstatic.com/tb/static-album/img/mouseleft.cur"), auto;
    }

    .img_land_right {
        width: 33%;
        height: 100%;
        position: fixed;
        right: 0;
        top: 0;
        z-index: 1002;
        cursor: url("https://tb2.bdstatic.com/tb/static-album/img/mouseright.cur"), auto;
    }

    .fullViewPlane>.pageHelper {
        position: fixed;
        display: flex !important;
        justify-content: space-between;
        right: 50px;
        line-height: 25px;
        bottom: 30px;
        background-color: rgba(28, 41, 35, 0.411);
        z-index: 1011 !important;
        box-sizing: border-box;
        font-weight: bold;
        color: rgb(53, 170, 142);
        font-size: 1rem;
        cursor: pointer;
    }

    .pageHelper:hover {
        background-color: rgba(17, 17, 17, 0.507);
    }

    .pageHelper .clickable {
        text-decoration-line: underline;
    }

    .pageHelper .clickable:hover {
        color: white;
    }

    .pageHelper .plane {
        z-index: 1010 !important;
        background-color: #3740426c;
        box-sizing: border-box;
        /* border: 1px solid red; */
        position: absolute;
        left: 0;
        bottom: 25px;
        color: rgb(255, 222, 38);
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.2);
        transition: height 0.4s;
        overflow: hidden;
    }

    .p-collapse {
        padding: 0 !important;
        height: 0px !important;
        transition: height 0.4s;
    }

    .pageHelper .b-main {
        width: 284px;
        overflow: hidden !important;
        transition: width 0.4s;
        display: flex;
        justify-content: space-between;
        white-space: nowrap !important;
    }


    .b-collapse {
        width: 0px !important;
        transition: width 0.4s;
    }

    .pageHelper .p-config {
        width: 320px;
        height: 300px;
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        padding-top: 10px;
        align-content: start;
        grid-gap: 10px 0px;
    }

    .pageHelper .p-downloader {
        width: 320px;
        height: 300px;
        display: flex;
        justify-content: center;
        align-items: flex-end;
    }

    .p-downloader canvas {
        margin-bottom: 5px;
        /* border: 1px solid greenyellow; */
    }

    .pageHelper .btn {
        color: rgb(255, 232, 176);
        cursor: pointer;
        border: 1px solid rgb(0, 0, 0);
        border-radius: 4px;
        height: 30px;
        font-weight: 900;
        background: rgb(70, 69, 98) none repeat scroll 0% 0%;
    }

    .fetched {
        border: 2px solid #602a5c !important;
    }

    .fetch-failed {
        border: 2px solid red !important;
    }

    .fetching {
        padding: 2px;
        border: none !important;
        animation: 1s linear infinite cco;
        -webkit-animation: 1s linear infinite cco;
    }

    .pageHelperFetching {
        border: none !important;
        animation: 1s linear infinite cco;
        -webkit-animation: 1s linear infinite cco;
    }

    @keyframes cco {
        0% {
            background-color: #f00;
        }

        50% {
            background-color: #48ff00;
        }

        100% {
            background-color: #ae00ff;
        }
    }

    .retract {
        width: 0;
        transition: width 0.7s;
    }

    .downloadBar {
        background-color: rgba(100, 100, 100, .8);
        height: 10px;
        width: 100%;
        position: absolute;
        bottom: 0;
    }
</style>

<body>
    <div class="fullViewPlane">
        <div class="img-node">
            <img title="a" style="height: auto; width: 100%"
                src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" />
        </div>
        <div class="img-node">
            <img title="a" style="height: auto; width: 100%"
                src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" />
        </div>
        <div class="img-node">
            <img title="a" style="height: auto; width: 100%"
                src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" />
        </div>
        <div class="img-node">
            <img title="a" style="height: auto; width: 100%"
                src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" />
        </div>
        <div class="img-node">
            <img title="a" style="height: auto; width: 100%"
                src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" />
        </div>
        <div class="img-node">
            <img title="a" style="height: auto; width: 100%"
                src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" />
        </div>
        <div class="img-node">
            <img title="a" style="height: auto; width: 100%"
                src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" />
        </div>
        <div class="img-node">
            <img title="a" style="height: auto; width: 100%"
                src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" />
        </div>
        <div class="img-node">
            <img title="a" style="height: auto; width: 100%"
                src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" />
        </div>
        <div class="img-node">
            <img title="a" style="height: auto; width: 100%"
                src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" />
        </div>
        <div class="img-node">
            <img title="a" style="height: auto; width: 100%"
                src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" />
        </div>
        <div class="img-node">
            <img title="a" style="height: auto; width: 100%"
                src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" />
        </div>
        <div class="bigImageFrame retract">
        </div>
        <div id="pageHelper" class="pageHelper">
            <div style="position: relative">
                <div id="configPlane" class="plane p-config p-collapse" onmouseover="mouseoverPlane(this)"
                    onmouseleave="mouseleavePlane(this)">
                    <div style="grid-column-start: 1; grid-column-end: 7; padding-left: 5px;">
                        <label>
                            <span style="vertical-align: middle;">背景图片:</span>
                            <input style="vertical-align: middle; width: auto;" type="text" />
                        </label>
                    </div>
                    <div style="grid-column-start: 1; grid-column-end: 6; padding-left: 5px;">
                        <label style="display: flex; justify-content: space-between; padding-right: 10px;">
                            <span>每行数量:</span>
                            <span>
                                <button type="button" onclick="modConfEvent(this, 'colCount', 'minus')">-</button>
                                <input id="colCountInput" disabled type="text" style="width: 15px;" />
                                <button type="button" onclick="modConfEvent(this, 'colCount', 'add')">+</button>
                            </span>
                        </label>
                    </div>
                    <div style="grid-column-start: 1; grid-column-end: 6; padding-left: 5px;">
                        <label style="display: flex; justify-content: space-between; padding-right: 10px;">
                            <span>最大同时加载:</span>
                            <span>
                                <button type="button" onclick="modConfEvent(this, 'threads', 'minus')">-</button>
                                <input id="threadsInput" disabled type="text" style="width: 15px;" />
                                <button type="button" onclick="modConfEvent(this, 'threads', 'add')">+</button>
                            </span>
                        </label>
                    </div>
                    <div style="grid-column-start: 1; grid-column-end: 6; padding-left: 5px;">
                        <label style="display: flex; justify-content: space-between; padding-right: 10px;">
                            <span>超时时间(秒):</span>
                            <span>
                                <button type="button" onclick="modConfEvent(this, 'timeout', 'minus')">-</button>
                                <input id="timeoutInput" disabled type="text" style="width: 15px;" />
                                <button type="button" onclick="modConfEvent(this, 'timeout', 'add')">+</button>
                            </span>
                        </label>
                    </div>
                    <div style="grid-column-start: 1; grid-column-end: 4; padding-left: 5px;">
                        <label>
                            <span>最佳质量:</span>
                            <input oninput="modConfEvent(this,'fetchOriginal')" type="checkbox"
                                style="height: 18px; width: 18px;" />
                        </label>
                    </div>
                    <div style="grid-column-start: 4; grid-column-end: 7; padding-left: 5px;">
                        <label>
                            <span>自动加载:</span>
                            <input oninput="modConfEvent(this, 'autoLoad')" type="checkbox"
                                style="height: 18px; width: 18px;" />
                        </label>
                    </div>
                    <div style="grid-column-start: 1; grid-column-end: 4; padding-left: 5px;">
                        <label>
                            <span>大图追随鼠标:</span>
                            <input oninput="modConfEvent(this, 'followMouse')" type="checkbox"
                                style="height: 18px; width: 18px;" />
                        </label>
                    </div>
                    <div style="grid-column-start: 4; grid-column-end: 7; padding-left: 5px;">
                        <label>
                            <span>保持缩放:</span>
                            <input oninput="modConfEvent(this, 'keepScale')" type="checkbox"
                                style="height: 18px; width: 18px;" />
                        </label>
                    </div>
                </div>
                <div id="downloaderPlane" class="plane p-downloader p-collapse" onmouseover="mouseoverPlane(this)"
                    onmouseleave="mouseleavePlane(this)">
                    <canvas id="downloaderCanvas" width="300" height="260" onmousewheel="canvasWheel(event)"></canvas>
                </div>
            </div>
            <div>
                <span onclick="togglePageHelper(0)"
                    style="font-weight: 800; font-size: large; text-align: center;">&lessdot;</span>
            </div>
            <!-- <span>展开</span> -->
            <div id="main" class="b-main b-collapse">
                <div class="clickable" style="z-index: 1111;" onmouseover="togglePlane('config', 0)"
                    onmouseout="togglePlane('config', 1)" onclick="togglePlane('config')"> 配置 </div>
                <div class="clickable" style="z-index: 1111;" onmouseover="togglePlane('downloader', 0)"
                    onmouseout="togglePlane('downloader', 1)" onclick="togglePlane('downloader')"> 下载 </div>
                <div class="page">
                    <span class="clickable"
                        style="color:orange;">0</span>/<span>100</span><span>FIN:</span></span>0</span>
                </div>
                <div class="clickable" onclick="togglePageHelper(1)">收起</div>
            </div>
            <div>
                <span onclick="togglePageHelper(0)"
                    style="font-weight: 800; font-size: large; text-align: center;">&gtdot;</span>
            </div>
        </div>
    </div>
</body>

<script>

    const conf = {
        backgroundImage: `data:image/png;base64,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`,
        colCount: 6, //每行显示的数量
        followMouse: false, //大图是否跟随鼠标
        keepScale: false, //是否保留缩放
        autoLoad: true, //是否启用空闲加载器
        fetchOriginal: false, //是否获取最佳质量的图片
        restartIdleLoader: 6000, //中止空闲加载器后的重新启动时间(毫秒)
        threads: 3, //同时加载的图片数量
        timeout: 8, //超时时间(秒)，默认8秒
        version: "2.1.1",
        debug: true,
        first: true,
    };

    function modConfEvent(ele, key, data) {
        switch (key) {
            default:
                if (["timeout", "threads", "colCount"].indexOf(key) !== -1) {
                    const range = {
                        colCount: [1, 12],
                        threads: [1, 10],
                        timeout: [2, 20],
                    }
                    if (data === "add") {
                        if (conf[key] < range[key][1]) {
                            conf[key]++
                        }
                    } else if (data === "minus") {
                        if (conf[key] > range[key][0]) {
                            conf[key]--
                        }
                    }
                    document.querySelector(`#${key}Input`).value = conf[key]
                    if (key === "colCount") {
                        const css_ = [].slice.call(document.styleSheets[0].cssRules).filter((rule) => rule.selectorText === ".fullViewPlane")?.[0];
                        css_.style.gridTemplateColumns = `repeat(${conf[key]}, 1fr)`;
                    }
                }
                if (["followMouse", "keepScale", "autoLoad", "fetchOriginal"].indexOf(key) !== -1) {
                    conf[key] = ele.checked
                    if (key === "autoLoad") { }
                }
        }
    }

    function togglePageHelper(type) {
        const ele = document.querySelector("#pageHelper #main")
        if (ele) {
            if (type == 1) {
                ele.classList.add("b-collapse")
            } else {
                ele.classList.remove("b-collapse")
            }
        }
    }

    function collapseFade(t) {
        console.log("collapse fade,", t)
    }

    let collapseLast = null

    function mouseoverPlane(target) {
        target.setAttribute("foucs", "foucs")
    }

    function mouseleavePlane(target) {
        target.removeAttribute("foucs")
        target.classList.add("p-collapse")
    }


    function togglePlane(id, type) {
        setTimeout(() => {
            let ele = null
            switch (id) {
                case "config":
                    ele = document.querySelector("#configPlane")
                    break;
                case "downloader":
                    ele = document.querySelector("#downloaderPlane")
                    break;
            }
            if (ele) {
                if (type == 0) {
                    ele.classList.remove("p-collapse")
                } else if (type == 1) {
                    if (ele.getAttribute("foucs") !== "foucs") {
                        mouseleavePlane(ele)
                        ele.classList.add("p-collapse")
                    }
                } else {
                    ele.classList.toggle("p-collapse")
                }
            }
        }, 1);
    }

    function canvasWheel(event) {
        console.log("canvas wheel,", event)
        dc.onwheel(event.deltaY)
    }

    class DownloaderCanvas {
        constructor(id) {
            this.canvas = document.getElementById(id);
            this.ctx = this.canvas.getContext("2d");
            this.list = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0];
            this.rectSize = 12; // 矩形大小(正方形)
            this.rectGap = 6; // 矩形之间间隔
            this.columns = 15; // 每行矩形数量
            this.padding = 7; // 画布内边距
            this.scrollTop = 0; // 滚动位置
            this.scrollSize = 10 // 每次滚动粒度

            for (let i = 0, j = 0; i < 600; i++) {
                if ((i + j) % this.columns > 5) {
                    this.list.push(1)
                } else {
                    this.list.push(0)
                }
                if (i % this.columns == 0) j++
            }
        }

        onwheel(deltaY) {
            deltaY = deltaY >> 1
            this.scrollTop += deltaY
            if (this.scrollTop < 0) this.scrollTop = 0
            const clientHeight = Math.ceil(this.list.length / this.columns) * (this.rectSize + this.rectGap) - this.rectGap
            const [w, h] = this.getWH()
            if (this.scrollTop + h > clientHeight + 20) this.scrollTop = clientHeight - h + 20
            this.draw()
        }

        draw() {
            const [w, h] = this.getWH()
            this.ctx.clearRect(0, 0, w, h)
            const startX = this.computeStartX()
            let startY = -this.scrollTop
            for (let i = 0, row = -1; i < this.list.length; i++) {
                const currCol = i % this.columns
                if (currCol == 0) {
                    row++
                }
                const atX = startX + ((this.rectSize + this.rectGap) * currCol)
                const atY = startY + ((this.rectSize + this.rectGap) * row)
                // if (currCol == 0) {
                //     console.log(`atY:${atY}`)
                // }

                if (atY > h) {
                    break
                }
                if (atY + this.rectSize < 0) {
                    continue
                }
                this.drawSmallRect(
                    atX,
                    atY,
                    this.list[i]
                );
            }
        }

        computeStartX() {
            const [w, h] = this.getWH();
            const drawW = this.rectSize * this.columns + this.rectGap * this.columns - 1;
            let startX = (w - drawW) >> 1;
            return startX
        }

        drawSmallRect(x, y, stat) {
            if (stat == 1) {
                this.ctx.fillStyle = "rgb(110, 200, 120)";
            } else {
                this.ctx.fillStyle = "rgba(200, 200, 200, 0.1)";
            }
            this.ctx.fillRect(x, y, this.rectSize, this.rectSize);
            this.ctx.shadowColor = '#d53';
            this.ctx.lineWidth = 1
            this.ctx.strokeStyle = "rgb(90, 90, 90)"
            this.ctx.strokeRect(x, y, this.rectSize, this.rectSize)
        }

        getWH() {
            return [this.canvas.width, this.canvas.height]
        }

    }


    const dc = new DownloaderCanvas("downloaderCanvas")
    dc.draw();

</script>

</html>